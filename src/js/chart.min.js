function createTimeMatrix(t,r){r||(r=1);for(var e=[],n=t.total,i=0;i<n;i++){for(var o=[],a=0;a<n;a++)o.push(r);e.push(o)}return e}function createRibbonMatrix(t){for(var r=createTimeMatrix(t,.5),e=t.groups,n=0;n<e.length;n++){var i=Math.round(e[n].time1),o=Math.round(e[n].time2);r[i][o]=1,r[o][i]=1}return r}const t=require("d3"),r=require("events").EventEmitter,e=require("util");var chartGroup,self,currentTime=-1,currentSelected=-1,chordChart=function(t,e){r.call(this),this.createChord(t,e),self=this};e.inherits(chordChart,r),module.exports=chordChart,chordChart.prototype.click=function(t){clickEvent=t},chordChart.prototype.createChord=function(r,e){var n=createTimeMatrix(r,1),i=t.select(e),o=(i.node().getBBox(),+i.attr("width")),a=+i.attr("height"),u=.5*Math.min(o,a)-10,c=u-20,l=l=c-2,s=l-10;i.selectAll(`*`).remove();var d=(t.formatPrefix(",.0",1e3),function(t,e){for(var n=r.groups,i=0;i<n.length;i++){var o=Math.round(n[i].time1),a=Math.round(n[i].time2);if(t.source.index==o&&t.target.index==a)return!0}return!1}),p=t.chord().padAngle(0),f=t.arc().innerRadius(u).outerRadius(c),h=t.arc().innerRadius(s).outerRadius(l),g=t.ribbon().radius(s),m=t.scaleOrdinal().domain(t.range(4)).range(["#2E3D49","#23527C","#02B3E4","#337AB7"]),y=i.append("g").attr("transform","translate("+o/2+","+a/2+")").datum(p(n)),x=y.append("g").attr("class","groups").selectAll("g").data(function(t){return t.groups}).enter().append("g");x.append("path").style("fill",function(t){return m(t.index)}).style("stroke",function(r){return t.rgb(m(r.index)).darker()}).attr("d",f).attr("class","outer-group").style("opacity",0);var v=function(t,r,e){currentSelected=e?r:-1;var n=x.selectAll(".inner-group");n.style("opacity",e?.5:1),n.filter(function(t){return t.index==currentSelected}).style("opacity",1);x.selectAll(".outer-group").filter(function(t){return t.index!=currentTime}).style("opacity",0);x.selectAll(".outer-group").filter(function(t){return t.index==currentSelected}).style("opacity",.8)};x.append("path").style("fill",function(t){return m(t.index)}).style("stroke",function(r){return t.rgb(m(r.index)).darker()}).attr("d",h).attr("class","inner-group").on("mouseover",function(t,r){v(t,r,!0)}).on("mouseout",function(t,r){v(t,r,!1)}).on("click",function(t,r){self.emit("click",r)}),y.append("g").attr("class","ribbons").selectAll("path").data(function(t){return t}).enter().append("path").filter(function(t,r){return d(t,r)}).attr("d",g).style("fill",function(t){return m(t.target.index)}).style("stroke",function(r){return t.rgb(m(r.target.index)).darker()}),chartGroup=x},chordChart.prototype.setChartTime=function(t){currentTime=t;chartGroup.selectAll(".outer-group").filter(function(t){return t.index!=currentSelected}).style("opacity",0);chartGroup.selectAll(".outer-group").filter(function(t){return t.index==currentTime}).style("opacity",1)};