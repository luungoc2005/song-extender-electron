function createTimeMatrix(t,r){r||(r=1);for(var e=[],n=t.total,o=0;o<n;o++){for(var a=[],i=0;i<n;i++)a.push(r);e.push(a)}return e}function createRibbonMatrix(t){for(var r=createTimeMatrix(t,.5),e=t.groups,n=0;n<e.length;n++){var o=Math.round(e[n].time1),a=Math.round(e[n].time2);r[o][a]=1,r[a][o]=1}return r}const t=require("d3"),r=require("events").EventEmitter,e=require("util");var chartGroup,self,currentTime=-1,currentSelected=-1,chordChart=function(t,e){r.call(this),this.createChord(t,e),self=this};e.inherits(chordChart,r),module.exports=chordChart,chordChart.prototype.click=function(t){clickEvent=t},chordChart.prototype.createChord=function(r,e){for(var n=[],o=0;o<r.total;o++)n.push(1);for(var a=t.pie()(n),i=[],u=0;u<r.groups.length;u++){var c=Math.round(r.groups[u].time1),l=Math.round(r.groups[u].time2),s=a[c],p=a[l];i.push({source:s,target:p})}var d=t.select(e),f=(d.node().getBBox(),+d.attr("width")),h=+d.attr("height"),g=.5*Math.min(f,h)-10,y=g-20,m=m=y-2,v=m-10;d.selectAll(`*`).remove();var b=(t.formatPrefix(",.0",1e3),t.arc().innerRadius(g).outerRadius(y)),x=t.arc().innerRadius(v).outerRadius(m),k=t.ribbon().radius(v),A=t.scaleOrdinal().domain(t.range(4)).range(["#2E3D49","#23527C","#02B3E4","#337AB7"]),C=d.append("g").attr("transform","translate("+f/2+","+h/2+")").datum(function(){return a}),M=C.append("g").attr("class","groups").selectAll("g").data(function(){return a}).enter().append("g");M.append("path").style("fill",function(t,r){return A(r)}).style("stroke",function(r,e){return t.rgb(A(e)).darker()}).attr("d",b).attr("class","outer-group").style("opacity",0);var T=function(t,r,e){currentSelected=e?r:-1;var n=d.selectAll(".ribbon-group");n.style("opacity",e?.4:.8);var o=M.selectAll(".inner-group");o.style("opacity",e?.5:1),o.filter(function(t){return t.index==currentSelected}).style("opacity",1);M.selectAll(".outer-group").filter(function(t){return t.index!=currentTime}).style("opacity",0);M.selectAll(".outer-group").filter(function(t){return t.index==currentSelected}).style("opacity",.8)};M.append("path").style("fill",function(t,r){return A(r)}).style("stroke",function(r,e){return t.rgb(A(e)).darker()}).attr("d",x).attr("class","inner-group").on("mouseover",function(t,r){T(t,r,!0)}).on("mouseout",function(t,r){T(t,r,!1)}).on("click",function(t,r){self.emit("click",r)}),C.append("g").attr("class","ribbons").selectAll("path").data(i).enter().append("path").attr("d",k).attr("class","ribbon-group").style("fill",function(t,r){return A(r)}).style("stroke",function(r,e){return t.rgb(A(e)).darker()}).style("opacity",.8),chartGroup=M},chordChart.prototype.setChartTime=function(t){currentTime=t;chartGroup.selectAll(".outer-group").filter(function(t){return t.index!=currentSelected}).style("opacity",0);chartGroup.selectAll(".outer-group").filter(function(t){return t.index==currentTime}).style("opacity",1)};